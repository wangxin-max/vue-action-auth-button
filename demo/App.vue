<template>
  <div class="container">
    <!-- å¤´éƒ¨ -->
    <div class="header">
      <h1>ğŸš€ ActionAuthButton ç»„ä»¶æ¼”ç¤º</h1>
      <p>
        ä¸€ä¸ªç®€æ´å¼ºå¤§çš„ Vue
        æƒé™æŒ‰é’®ç»„ä»¶ï¼Œæ”¯æŒè¯¦æƒ…ã€ç¼–è¾‘ã€æ–°å¢ã€åˆ é™¤ç­‰æ“ä½œçš„æƒé™æ§åˆ¶å’ŒäºŒæ¬¡ç¡®è®¤
      </p>
    </div>

    <!-- æƒé™æ§åˆ¶æ¼”ç¤º -->
    <div class="demo-section">
      <h2>ğŸ” æƒé™æ§åˆ¶æ¼”ç¤º</h2>

      <div class="permission-control">
        <h3>å½“å‰æƒé™çŠ¶æ€</h3>
        <p>
          <strong>æƒé™çº§åˆ«:</strong>
          {{
            currentPermission === '*'
              ? 'è¶…çº§ç®¡ç†å‘˜ (*)'
              : currentPermission === 'none'
              ? 'æ— æƒé™'
              : currentPermission
          }}
        </p>

        <a-space>
          <span>åˆ‡æ¢æƒé™:</span>
          <a-button type="primary" @click="setPermission('*')">
            è¶…çº§ç®¡ç†å‘˜
          </a-button>
          <a-button @click="setPermission('user:edit')"> ç¼–è¾‘æƒé™ </a-button>
          <a-button @click="setPermission('user:view')"> æŸ¥çœ‹æƒé™ </a-button>
          <a-button danger @click="setPermission('none')"> æ— æƒé™ </a-button>
        </a-space>

        <div style="margin-top: 10px">
          <small
            >ğŸ’¡ æç¤ºï¼šå½“å‰ä½¿ç”¨çœŸå®çš„ ActionAuthButton ç»„ä»¶ï¼Œæƒé™åŸºäºæ¨¡æ‹Ÿçš„ Vuex
            store</small
          >
        </div>
      </div>

      <h3>ActionAuthButton ç»„ä»¶æ¼”ç¤º</h3>
      <div class="button-group">
        <!-- æŸ¥çœ‹æŒ‰é’® -->
        <ActionAuthButton type="view" :record="record" @view="handleView" />

        <!-- ç¼–è¾‘æŒ‰é’® -->
        <ActionAuthButton type="edit" :record="record" @edit="handleEdit" />

        <!-- åˆ é™¤æŒ‰é’® -->
        <ActionAuthButton
          type="delete"
          :record="record"
          @delete="handleDelete"
        />

        <!-- æ–°å¢æŒ‰é’® -->
        <ActionAuthButton type="add" button-type="primary" @add="handleAdd">
          æ–°å¢ç”¨æˆ·
        </ActionAuthButton>

        <!-- è‡ªå®šä¹‰æŒ‰é’® -->
        <ActionAuthButton
          type="custom"
          button-type="default"
          icon="export"
          @click="handleExport"
        >
          å¯¼å‡ºæ•°æ®
        </ActionAuthButton>
      </div>
    </div>

    <!-- ç»„ä»¶ç‰¹æ€§ -->
    <div class="demo-section">
      <h2>âœ¨ ç»„ä»¶ç‰¹æ€§</h2>
      <div class="feature-grid">
        <div class="feature-card">
          <h4>ğŸ”’ æƒé™æ£€æŸ¥</h4>
          <p>æ ¹æ® Vuex store ä¸­çš„æƒé™è‡ªåŠ¨æ˜¾ç¤º/éšè—æŒ‰é’®ï¼Œæ”¯æŒç»†ç²’åº¦æƒé™æ§åˆ¶</p>
        </div>
        <div class="feature-card">
          <h4>ğŸ¨ ç»Ÿä¸€æ ·å¼</h4>
          <p>ä¸åŒæ“ä½œç±»å‹çš„æŒ‰é’®æœ‰ä¸åŒçš„é»˜è®¤æ ·å¼å’Œå›¾æ ‡ï¼Œä¿æŒç•Œé¢ä¸€è‡´æ€§</p>
        </div>
        <div class="feature-card">
          <h4>âŒ å†…ç½®ç¡®è®¤</h4>
          <p>åˆ é™¤æ“ä½œå†…ç½®ç¡®è®¤å¼¹çª—ï¼Œé˜²æ­¢è¯¯æ“ä½œï¼Œæé«˜ç”¨æˆ·ä½“éªŒ</p>
        </div>
        <div class="feature-card">
          <h4>âš¡ ç®€åŒ–ä»£ç </h4>
          <p>ä¸€è¡Œä»£ç æ›¿ä»£å¤šè¡Œæƒé™æ£€æŸ¥é€»è¾‘ï¼Œå¤§å¹…å‡å°‘é‡å¤ä»£ç </p>
        </div>
        <div class="feature-card">
          <h4>ğŸ› ï¸ çµæ´»é…ç½®</h4>
          <p>æ”¯æŒè‡ªå®šä¹‰å›¾æ ‡ã€æ–‡æœ¬ã€çŠ¶æ€ç­‰ï¼Œæ»¡è¶³ä¸åŒä¸šåŠ¡éœ€æ±‚</p>
        </div>
        <div class="feature-card">
          <h4>ğŸŒ å…¼å®¹æ€§å¥½</h4>
          <p>åŒæ—¶æ”¯æŒ Vue 2.x å’Œ Vue 3.xï¼Œå…¼å®¹å„ç§é¡¹ç›®ç¯å¢ƒ</p>
        </div>
      </div>
    </div>

    <!-- ä»£ç å¯¹æ¯” -->
    <div class="demo-section">
      <h2>ğŸ“ ä»£ç å¯¹æ¯”</h2>
      <div class="comparison">
        <div>
          <h3>ä¼ ç»Ÿæ–¹å¼ (å¤æ‚)</h3>
          <div class="code-block">
            <pre>{{ traditionalCode }}</pre>
          </div>
        </div>
        <div>
          <h3>ä½¿ç”¨ ActionAuthButton (ç®€æ´)</h3>
          <div class="code-block">
            <pre>{{ componentCode }}</pre>
          </div>
        </div>
      </div>
      <div style="text-align: center; margin-top: 20px">
        <a-tag color="green" style="font-size: 16px; padding: 4px 12px">
          ä»£ç å‡å°‘ 70%ï¼ŒåŠŸèƒ½æ›´å¼ºå¤§ï¼ğŸš€
        </a-tag>
      </div>
    </div>

    <!-- æ“ä½œç±»å‹ -->
    <div class="demo-section">
      <h2>ğŸ¯ æ”¯æŒçš„æ“ä½œç±»å‹</h2>
      <div style="display: flex; flex-wrap: wrap; gap: 10px; margin: 15px 0">
        <a-tag color="blue" style="font-size: 14px; padding: 4px 8px"
          >view - æŸ¥çœ‹è¯¦æƒ…</a-tag
        >
        <a-tag color="green" style="font-size: 14px; padding: 4px 8px"
          >edit - ç¼–è¾‘æ•°æ®</a-tag
        >
        <a-tag color="red" style="font-size: 14px; padding: 4px 8px"
          >delete - åˆ é™¤æ•°æ® (å†…ç½®ç¡®è®¤)</a-tag
        >
        <a-tag color="purple" style="font-size: 14px; padding: 4px 8px"
          >add - æ–°å¢æ•°æ®</a-tag
        >
        <a-tag color="orange" style="font-size: 14px; padding: 4px 8px"
          >custom - è‡ªå®šä¹‰æ“ä½œ</a-tag
        >
      </div>
    </div>

    <!-- ä½¿ç”¨ç¤ºä¾‹ -->
    <div class="demo-section">
      <h2>ğŸ’¡ åŸºæœ¬ä½¿ç”¨</h2>
      <div class="code-block">
        <pre>{{ usageExample }}</pre>
      </div>
    </div>

    <!-- æµ‹è¯•æ•°æ®è¡¨æ ¼ -->
    <div class="demo-section">
      <h2>ğŸ“Š æ¨¡æ‹Ÿæ•°æ®è¡¨æ ¼</h2>
      <a-table
        :columns="columns"
        :data-source="tableData"
        :pagination="false"
        size="middle"
      >
        <template slot="action" slot-scope="text, record">
          <ActionAuthButton type="view" :record="record" @view="handleView" />
          <ActionAuthButton type="edit" :record="record" @edit="handleEdit" />
          <ActionAuthButton
            type="delete"
            :record="record"
            @delete="handleDelete"
          />
        </template>
      </a-table>
    </div>
  </div>
</template>

<script>
import ActionAuthButton from '@/ActionAuthButton.vue'

export default {
  name: 'App',
  components: {
    ActionAuthButton,
  },
  data() {
    return {
      currentPermission: '*',
      record: {
        id: 1,
        name: 'æµ‹è¯•æ•°æ®',
        description: 'è¿™æ˜¯ä¸€æ¡æµ‹è¯•è®°å½•ï¼Œç”¨äºæ¼”ç¤ºæƒé™æŒ‰é’®åŠŸèƒ½',
        createTime: '2024-01-01 10:00:00',
      },
      columns: [
        {
          title: 'ID',
          dataIndex: 'id',
          key: 'id',
          width: 80,
        },
        {
          title: 'å§“å',
          dataIndex: 'name',
          key: 'name',
        },
        {
          title: 'æè¿°',
          dataIndex: 'description',
          key: 'description',
        },
        {
          title: 'åˆ›å»ºæ—¶é—´',
          dataIndex: 'createTime',
          key: 'createTime',
        },
        {
          title: 'æ“ä½œ',
          key: 'action',
          scopedSlots: { customRender: 'action' },
          width: 200,
        },
      ],
      tableData: [
        {
          id: 1,
          name: 'å¼ ä¸‰',
          description: 'è¿™æ˜¯å¼ ä¸‰çš„æè¿°ä¿¡æ¯',
          createTime: '2024-01-01 10:00:00',
        },
        {
          id: 2,
          name: 'æå››',
          description: 'è¿™æ˜¯æå››çš„æè¿°ä¿¡æ¯',
          createTime: '2024-01-02 11:00:00',
        },
        {
          id: 3,
          name: 'ç‹äº”',
          description: 'è¿™æ˜¯ç‹äº”çš„æè¿°ä¿¡æ¯',
          createTime: '2024-01-03 12:00:00',
        },
      ],
      traditionalCode: `<span v-show="hasButtonAuthority(currentPermissionId, 'view')"
      @click="handleView(record)">
  <a-icon type="eye" /> è¯¦æƒ…
</span>
<span v-show="hasButtonAuthority(currentPermissionId, 'edit')"
      @click="handleEdit(record)">
  <a-icon type="edit" /> ç¼–è¾‘
</span>
<a-popconfirm v-show="hasButtonAuthority(currentPermissionId, 'delete')"
               title="ç¡®è®¤åˆ é™¤?"
               @confirm="handleDelete(record)">
  <span><a-icon type="delete" /> åˆ é™¤</span>
</a-popconfirm>`,
      componentCode: `<ActionAuthButton type="view" :record="record"
                    @view="handleView" />
<ActionAuthButton type="edit" :record="record"
                    @edit="handleEdit" />
<ActionAuthButton type="delete" :record="record"
                    @delete="handleDelete" />`,
      usageExample: `&lt;template&gt;
  &lt;!-- è¯¦æƒ…æŒ‰é’® --&gt;
  &lt;ActionAuthButton type="view" :record="record" @view="handleView" /&gt;

  &lt;!-- ç¼–è¾‘æŒ‰é’® --&gt;
  &lt;ActionAuthButton type="edit" :record="record" @edit="handleEdit" /&gt;

  &lt;!-- åˆ é™¤æŒ‰é’®ï¼ˆå†…ç½®ç¡®è®¤å¼¹çª—ï¼‰ --&gt;
  &lt;ActionAuthButton type="delete" :record="record" @delete="handleDelete" /&gt;

  &lt;!-- æ–°å¢æŒ‰é’® --&gt;
  &lt;ActionAuthButton type="add" button-type="primary" @add="handleAdd"&gt;
    æ–°å¢
  &lt;/ActionAuthButton&gt;
&lt;/template&gt;

&lt;script&gt;
import ActionAuthButton from '@/components/ActionAuthButton/ActionAuthButton.vue'

export default {
  components: { ActionAuthButton },
  methods: {
    handleView(record) { console.log('æŸ¥çœ‹:', record) },
    handleEdit(record) { console.log('ç¼–è¾‘:', record) },
    handleDelete(record) { console.log('åˆ é™¤:', record) },
    handleAdd() { console.log('æ–°å¢') }
  }
}
&lt;/script&gt;`,
    }
  },
  created() {
    // åˆå§‹åŒ–æ¨¡æ‹Ÿçš„ç”¨æˆ·æƒé™æ•°æ®
    this.initMockUserPermissions()
  },
  methods: {
    initMockUserPermissions() {
      // æ¨¡æ‹Ÿå­˜å‚¨ç”¨æˆ·æƒé™åˆ° localStorage
      const mockUserData = {
        userId: '1',
        loginId: 'admin',
        username: 'è¶…çº§ç®¡ç†å‘˜',
        permissions: [
          {
            id: '21e984d361504688b7028b5a775ff838',
            operation: ['delete', 'edit', 'add', 'view'],
          },
        ],
      }
      localStorage.setItem('admin.user', JSON.stringify(mockUserData))
    },

    setPermission(permission) {
      this.currentPermission = permission

      // æ›´æ–° Vuex store ä¸­çš„æƒé™
      this.$store.commit('setting/SET_CURRENT_PERMISSION_ID', permission)

      // æ›´æ–° localStorage ä¸­çš„ç”¨æˆ·æƒé™
      const mockUserData = {
        userId: '1',
        loginId: 'admin',
        username: 'è¶…çº§ç®¡ç†å‘˜',
        permissions:
          permission === 'none'
            ? []
            : [
                {
                  id: permission,
                  operation: ['view', 'edit', 'add', 'delete'],
                },
              ],
      }
      localStorage.setItem('admin.user', JSON.stringify(mockUserData))

      this.$message.success(
        `æƒé™å·²åˆ‡æ¢åˆ°: ${permission === '*' ? 'è¶…çº§ç®¡ç†å‘˜' : permission}`
      )
    },

    handleView(record) {
      this.$message.info(
        'æŸ¥çœ‹æ“ä½œ: ' + JSON.stringify(record || this.record, null, 2)
      )
    },

    handleEdit(record) {
      this.$message.info(
        'ç¼–è¾‘æ“ä½œ: ' + JSON.stringify(record || this.record, null, 2)
      )
    },

    handleDelete(record) {
      this.$message.success(
        'åˆ é™¤æˆåŠŸ: ' + JSON.stringify(record || this.record, null, 2)
      )
    },

    handleAdd() {
      this.$message.info('æ–°å¢æ“ä½œ')
    },

    handleExport() {
      this.$message.info('å¯¼å‡ºæ“ä½œ')
    },
  },
}
</script>

<style scoped>
/* è¿™é‡Œå¯ä»¥æ·»åŠ ç»„ä»¶ç‰¹å®šçš„æ ·å¼ */
</style>
